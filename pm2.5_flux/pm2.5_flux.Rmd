---
title: "pm2.5_flux"
author: "Veronica Weber"
date: "11/25/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Background 

# Methods from the Hirabayashi and Nowak study: "Comprehensive national database of tree effects on air quality and human health in the United States" - 2015
# Hourly pollutant flux per unit tree cover, F (ug m^-2 h^-1) was
# estimated as a product of the dry deposition velocity, Vd (m h^-1 ),
# and the air pollutant concentration, C (mg m^-3): F = Vd*C
# Vd for PM2.5 for unit LAI was estimated based on the median of deposition velocity measurements for varied wind speeds reported in the literature. Vd was then multiplied by LAI, and F for PM2.5 was computed accounting for the resuspension of the particles from leaves to the atmosphere due to the wind and wash-off of particles from leaves to the ground by precipitation. The detailed process for PM2.5 dry depositions is given in Nowak et al. (2013).



# Methods from the study"
# Deposition velocities of PM2.5 to trees were estimated from the literature and varied with wind speed 
# (Beckett et al., 2000b; Freer-Smith et al., 2004; Pullman, 2009). These papers measured deposition     
# velocities to tree leaves from 17 tree species under wind speeds of 1, 3, 6, 8, 9 and 10 m s^-1. For  each wind speed, the median deposition velocities from the measured deposition velocities was used to
# estimate the Vd for that wind speed per unit leaf area (Table 2). 

#The standard error of the estimates among the species was used to estimate a potential range of values of deposition velocities. The 95 percent confidence interval of median deposition velocity per wind speed was used to estimate a maximum deposition for the wind speed. As 95 percent confidence interval for the lower range of deposition velocities produced negative deposition velocities, the minimum average Vd from any species was used to represent the minimum Vd for the wind speed. 

#To estimate the Vd for wind speeds between 1 and 10 m s^-1 that did not have a measured Vd, values were interpolated between the closest measured values. For wind speeds above 10 m s^-11, the Vd for 10 m s^-1 was used; for a wind speed of 0 m s^-1, the Vd was assumed to be 0ms^-1 (Table 3).

# Resuspension of PM2.5 from trees was estimated from Pullman (2009) and varied with wind speed. This paper measured percent resuspension of PM2.5 from tree leaves of three tree species under wind speeds of 6.5, 10 and 13 m s1. The average percent resuspension for the trees species and wind speed was calculated
# (Table 3). As the percent resuspension for the wind speed of 6.5 m s1 was 9.5%, a value of 9% was assumed for a wind speed of 6 m s1 and 10% for 7 m s1. The percent resuspension for a wind speed of 0 m s1 was assumed to be 0%. To estimate the percent resuspension for wind speeds between 0 and 13 m s1 that did not have measured resuspension rates, values were interpolated from the closest measured values (or assumed value at wind speed of 0 m s1). For wind speeds above 13 m s1, the percent resuspension rate for 13 m s1 was used (Table 3).

# To calculate pollution removal, local city weather data from the National Climatic Data Center were used to obtain hourly wind speed and precipitation data. Hourly flux values to trees in the city (Eq. (1); mg m2 h1) were multiplied by total leaf surface area (m2) with hourly Vd based on local wind speed (Table 3). Flux values were accumulated hourly with a percent of the total accumulated PM2.5 over the
# current and previous hours resuspended back to the atmosphere hourly based on local wind speed. PM2.5 was accumulated upon leaves and resuspended from leaves during non-precipitation periods.

# During precipitation events, the accumulated PM2.5 was assumed to be washed off to the ground surface depending upon the magnitude of the precipitation event (Pe in mm). As leaves capture about 0.2 mm of
# precipitation (Wang et al., 2008) before runoff from the leaf, the total precipitation storage capacity (Ps in mm) of the canopy was calculated as 0.2  LAI. If Pe was greater than Ps, then all particles were assumed to be removed from the leaves and resuspension dropped to zero. When the Pe was less than Ps, no particles were removed from the leaves as there was no runoff from the leaves. After the rain stopped, PM2.5 began accumulating on and resuspending from leaves again. Water on the leaves after rain events was reduced hourly based on evaporation rates calculated from meteorological conditions. The annual flux to tree leaves was estimated as the total PM2.5 washed off leaves during the year plus the amount remaining on leaves at the end of the year.

```

```{r}
library(tidyverse)
library(janitor)
library(lubridate)
library(tidyr)


# import data set
narrows <- read_csv("raw_data/tacoma_narrows_hourly.csv") %>% 
clean_names() 

narrows_tidy <- narrows %>% 
  select(date, hourly_dry_bulb_temperature,
         hourly_precipitation, hourly_wind_speed,
         hourly_station_pressure,
         hourly_sea_level_pressure)

narrows_tidier <- as.Date(narrows_tidy$date)

narrows_date <- narrows_tidy %>% 
  mutate(
    date_new = lubridate::ymd_hms(date)
  )
# Found a base r command to extract the year-month-date and hours-minutes-seconds
narrows_date$date_ymd <- as.Date(narrows_date$date_new)
narrows_date$date_hms <- format(narrows_date$date,"%H:%M:%S")
narrows_date$date_h <- format(narrows_date$date, "%H")
 
```

